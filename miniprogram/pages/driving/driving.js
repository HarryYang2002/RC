"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const routing_1 = require("../../utils/routing");
const centPerSec = 0.7;
function formatDuration(sec) {
    const padString = (n) => n < 10 ? '0' + n.toFixed(0) : n.toFixed(0);
    const h = Math.floor(sec / 3600);
    sec -= 3600 * h;
    const m = Math.floor(sec / 60);
    sec -= 60 * m;
    const s = Math.floor(sec);
    return `${padString(h)}:${padString(m)}:${padString(s)}`;
}
function formatFee(cents) {
    return (cents / 100).toFixed(2);
}
Page({
    timer: undefined,
    data: {
        location: {
            latitude: 32.92,
            longitude: 118.46,
        },
        scale: 14,
        elapsed: '00:00:00',
        fee: '0.00',
    },
    onLoad(opt) {
        const o = opt;
        console.log("current trip", o.trip_id);
        this.setupLocationUpdator();
        this.setupTimer();
    },
    onUnload() {
        wx.stopLocationUpdate();
        if (this.timer) {
            clearInterval(this.timer);
        }
    },
    setupLocationUpdator() {
        wx.startLocationUpdate({
            fail: console.error,
        });
        wx.onLocationChange(loc => {
            console.log("location: ", loc);
            this.setData({
                location: {
                    latitude: loc.latitude,
                    longitude: loc.longitude,
                },
            });
        });
    },
    setupTimer() {
        let elapsedSec = 0;
        let cents = 0;
        this.timer = setInterval(() => {
            elapsedSec++;
            cents += centPerSec;
            this.setData({
                elapsed: formatDuration(elapsedSec),
                fee: formatFee(cents),
            });
        }, 1000);
    },
    onEndTripTap() {
        wx.redirectTo({
            url: routing_1.routing.mytrips(),
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJpdmluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRyaXZpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSxpREFBOEM7QUFFOUMsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFBO0FBRXRCLFNBQVMsY0FBYyxDQUFDLEdBQVc7SUFDL0IsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFTLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVFLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFBO0lBQ2hDLEdBQUcsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFBO0lBQ2YsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUE7SUFDOUIsR0FBRyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDYixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3pCLE9BQU8sR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO0FBQzVELENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxLQUFhO0lBQzVCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ25DLENBQUM7QUFFRCxJQUFJLENBQUM7SUFDRCxLQUFLLEVBQUUsU0FBK0I7SUFDdEMsSUFBSSxFQUFFO1FBQ0YsUUFBUSxFQUFFO1lBQ04sUUFBUSxFQUFFLEtBQUs7WUFDZixTQUFTLEVBQUUsTUFBTTtTQUNwQjtRQUNELEtBQUssRUFBRSxFQUFFO1FBQ1QsT0FBTyxFQUFFLFVBQVU7UUFDbkIsR0FBRyxFQUFFLE1BQU07S0FDZDtJQUVELE1BQU0sQ0FBQyxHQUE4QjtRQUNqQyxNQUFNLENBQUMsR0FBd0IsR0FBRyxDQUFBO1FBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQTtRQUMzQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7SUFDckIsQ0FBQztJQUNELFFBQVE7UUFDSixFQUFFLENBQUMsa0JBQWtCLEVBQUUsQ0FBQTtRQUN2QixJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDWixhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQzVCO0lBQ0wsQ0FBQztJQUVELG9CQUFvQjtRQUNoQixFQUFFLENBQUMsbUJBQW1CLENBQUM7WUFDbkIsSUFBSSxFQUFFLE9BQU8sQ0FBQyxLQUFLO1NBQ3RCLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN0QixPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQTtZQUM5QixJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULFFBQVEsRUFBRTtvQkFDTixRQUFRLEVBQUUsR0FBRyxDQUFDLFFBQVE7b0JBQ3RCLFNBQVMsRUFBRSxHQUFHLENBQUMsU0FBUztpQkFDM0I7YUFDSixDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxVQUFVO1FBQ04sSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFBO1FBQ2xCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQTtRQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRTtZQUMxQixVQUFVLEVBQUUsQ0FBQTtZQUNaLEtBQUssSUFBSSxVQUFVLENBQUE7WUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDVCxPQUFPLEVBQUUsY0FBYyxDQUFDLFVBQVUsQ0FBQztnQkFDbkMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxLQUFLLENBQUM7YUFDeEIsQ0FBQyxDQUFBO1FBQ04sQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ1osQ0FBQztJQUVELFlBQVk7UUFDUixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1YsR0FBRyxFQUFDLGlCQUFPLENBQUMsT0FBTyxFQUFFO1NBQ3hCLENBQUMsQ0FBQTtJQUNOLENBQUM7Q0FDSixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9kcml2aW5nL2RyaXZpbmcudHNcclxuXHJcbmltcG9ydCB7IHJvdXRpbmcgfSBmcm9tIFwiLi4vLi4vdXRpbHMvcm91dGluZ1wiO1xyXG5cclxuY29uc3QgY2VudFBlclNlYyA9IDAuN1xyXG5cclxuZnVuY3Rpb24gZm9ybWF0RHVyYXRpb24oc2VjOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IHBhZFN0cmluZyA9IChuOiBudW1iZXIpID0+IG4gPCAxMCA/ICcwJyArIG4udG9GaXhlZCgwKSA6IG4udG9GaXhlZCgwKTtcclxuICAgIGNvbnN0IGggPSBNYXRoLmZsb29yKHNlYyAvIDM2MDApXHJcbiAgICBzZWMgLT0gMzYwMCAqIGhcclxuICAgIGNvbnN0IG0gPSBNYXRoLmZsb29yKHNlYyAvIDYwKVxyXG4gICAgc2VjIC09IDYwICogbVxyXG4gICAgY29uc3QgcyA9IE1hdGguZmxvb3Ioc2VjKVxyXG4gICAgcmV0dXJuIGAke3BhZFN0cmluZyhoKX06JHtwYWRTdHJpbmcobSl9OiR7cGFkU3RyaW5nKHMpfWBcclxufVxyXG5cclxuZnVuY3Rpb24gZm9ybWF0RmVlKGNlbnRzOiBudW1iZXIpIHtcclxuICAgIHJldHVybiAoY2VudHMgLyAxMDApLnRvRml4ZWQoMilcclxufVxyXG5cclxuUGFnZSh7XHJcbiAgICB0aW1lcjogdW5kZWZpbmVkIGFzIG51bWJlciB8IHVuZGVmaW5lZCxcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBsb2NhdGlvbjoge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogMzIuOTIsXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogMTE4LjQ2LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2NhbGU6IDE0LFxyXG4gICAgICAgIGVsYXBzZWQ6ICcwMDowMDowMCcsXHJcbiAgICAgICAgZmVlOiAnMC4wMCcsXHJcbiAgICB9LFxyXG5cclxuICAgIG9uTG9hZChvcHQ6IFJlY29yZDxcInRyaXBfaWRcIiwgc3RyaW5nPikge1xyXG4gICAgICAgIGNvbnN0IG86IHJvdXRpbmcuRHJpdmluZ09wdHMgPSBvcHRcclxuICAgICAgICBjb25zb2xlLmxvZyhcImN1cnJlbnQgdHJpcFwiLCBvLnRyaXBfaWQpO1xyXG4gICAgICAgIHRoaXMuc2V0dXBMb2NhdGlvblVwZGF0b3IoKVxyXG4gICAgICAgIHRoaXMuc2V0dXBUaW1lcigpXHJcbiAgICB9LFxyXG4gICAgb25VbmxvYWQoKSB7XHJcbiAgICAgICAgd3guc3RvcExvY2F0aW9uVXBkYXRlKClcclxuICAgICAgICBpZiAodGhpcy50aW1lcikge1xyXG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzZXR1cExvY2F0aW9uVXBkYXRvcigpIHtcclxuICAgICAgICB3eC5zdGFydExvY2F0aW9uVXBkYXRlKHtcclxuICAgICAgICAgICAgZmFpbDogY29uc29sZS5lcnJvcixcclxuICAgICAgICB9KVxyXG4gICAgICAgIHd4Lm9uTG9jYXRpb25DaGFuZ2UobG9jID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2NhdGlvbjogXCIsIGxvYylcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IGxvYy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IGxvYy5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG5cclxuICAgIHNldHVwVGltZXIoKSB7XHJcbiAgICAgICAgbGV0IGVsYXBzZWRTZWMgPSAwXHJcbiAgICAgICAgbGV0IGNlbnRzID0gMFxyXG4gICAgICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGVsYXBzZWRTZWMrK1xyXG4gICAgICAgICAgICBjZW50cyArPSBjZW50UGVyU2VjXHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBlbGFwc2VkOiBmb3JtYXREdXJhdGlvbihlbGFwc2VkU2VjKSxcclxuICAgICAgICAgICAgICAgIGZlZTogZm9ybWF0RmVlKGNlbnRzKSxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LCAxMDAwKVxyXG4gICAgfSxcclxuXHJcbiAgICBvbkVuZFRyaXBUYXAoKSB7XHJcbiAgICAgICAgd3gucmVkaXJlY3RUbyh7XHJcbiAgICAgICAgICAgIHVybDpyb3V0aW5nLm15dHJpcHMoKSxcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG59KSJdfQ==